
<?php
if (  has_term( array( 'startovaci-balik','orto-starter' ), 'product_cat', get_the_id() )  )   :
?>



<section  class="why-section">
  <div style="max-width: 1440px;" class="container why-container">

    <!-- Left Video -->
    <div class="why-col">
      <div class="video-wrapper">
          <img style="" src="/sk/wp-content/themes/noriks/img/starter-1.png
">
      </div>
    </div>

    <!-- Right Content -->
    <div class="why-col why-content">
      <h2 style="color: #222; text-align:left; margin-left: 20px; font-family: 'Barlow', sans-serif; color:#222223;">
PREƒåO SI ƒΩUDIA VYBERAJ√ö ≈†TARTOVAC√ç BAL√çK?
      </h2>

      <div style="margin-left: 20px;" class="why-point">
        <p  style="    font-style: italic;
    line-height: 1.2;"  ><strong>"Vzal som si ho, lebo som si nebol ist√Ω, ƒçi mi bude sedie≈•."



</strong><span style="font-weight:normal;">Marek - Bratislava</span></p>
        <p class="description">Mnoh√≠ z√°kazn√≠ci zaƒç√≠naj√∫ so ≈°tartovac√≠m bal√≠kom, preto≈æe si chc√∫ najprv vysk√∫≈°a≈•, ako NORIKS sed√≠ a nos√≠ sa. Jedno triƒçko a jedny boxerky staƒçia na rozhodnutie bez veƒækej invest√≠cie.



</p>
      </div>

      <div style="margin-left: 20px;" class="why-point">
        <p  style="    font-style: italic;
    line-height: 1.2;" ><strong>"Po prvom nosen√≠ som si hneƒè objednal ƒèal≈°ie."



</strong><span style="font-weight:normal;">Pavol - Ko≈°ice</span></p>
        <p class="description">Viac ako 95% z√°kazn√≠kov po ≈°tartovacom bal√≠ku znova objedn√°. Nie preto, ≈æe to pl√°novali, ale preto, ≈æe u≈æ prv√Ω de≈à poc√≠tia rozdiel v strihu, pohodl√≠ a kvalite.


</p>
      </div>

      <div style="margin-left: 20px;" class="why-point">
        <p  style="    font-style: italic;
    line-height: 1.2;"  ><strong>"Materi√°l a strih ma presvedƒçili."



</strong><span style="font-weight:normal;">Anton - ≈Ωilina</span></p>
        <p class="description">Triƒçko a boxerky s√∫ m√§kk√©, ƒæahk√© a pr√≠jemn√© na poko≈æke. ≈†tartovac√≠ bal√≠k je najƒçastej≈°√≠ d√¥vod, preƒço sa NORIKS r√Ωchlo stane s√∫ƒças≈•ou ka≈ædodenn√©ho ≈°atn√≠ka.



</p>
      </div>
    </div>

  </div>
</section>



<section style="background: white;" class="why-section">
   <div style="max-width: 1440px;" class="container why-container">

    <!-- Left Video -->
    <div class="why-col">
      <div class="video-wrapper">
           <img style="" src="/sk/wp-content/themes/noriks/img/starter-2.png
">
      </div>
    </div>

    <!-- Right Content -->
    <div class="why-col why-content">
      <h2 style="color: #222; text-align:left; margin-left: 20px; font-family: 'Barlow', sans-serif; color:#222223;">
KOMBIN√ÅCIA, KTOR√Å SA NOS√ç KA≈ΩD√ù DE≈á

      </h2>

      <div style="margin-left: 20px;" class="why-point">
        <p><strong>Navrhnut√© pre celodenn√© pohodlie


</strong></p>
        <p class="description">Triƒçko a boxerky s√∫ vytvoren√© na nosenie od r√°na do veƒçera, bez potreby prisp√¥sobovania a nepohodlia. V≈°etko sed√≠ na svojom mieste, nes≈•ahuje a umo≈æ≈àuje voƒæn√Ω pohyb poƒças cel√©ho d≈àa.


</p>
      </div>

      <div style="margin-left: 20px;" class="why-point">
        <p><strong>Strih, ktor√Ω spolupracuje s telom


</strong></p>
        <p class="description">Strih triƒçka zv√Ωraz≈àuje horn√∫ ƒças≈• tela, zatiaƒæ ƒço boxerky poskytuj√∫ dostatok priestoru a stabilitu bez zdv√≠hania. V√Ωsledkom je ist√Ω, uvoƒænen√Ω pocit a upraven√Ω vzhƒæad v ka≈ædej situ√°cii.


</p>
      </div>

      <div style="margin-left: 20px;" class="why-point">
        <p><strong>Kvalita, ktor√∫ poc√≠tite okam≈æite


</strong></p>
        <p class="description">Materi√°ly s√∫ m√§kk√©, priedu≈°n√© a pr√≠jemn√© na poko≈æke bez straty tvaru po pran√≠. U≈æ pri prvom nosen√≠ je jasn√©, preƒço sa t√°to kombin√°cia r√Ωchlo st√°va s√∫ƒças≈•ou ka≈ædodenn√©ho ≈°atn√≠ka.


</p>
      </div>
    </div>

  </div>
</section>






<section class="why-section">
   <div style="max-width: 1440px;" class="container why-container">

    <!-- Left Video -->
    <div class="why-col">
      <div class="video-wrapper">
          <img style="" src="/sk/wp-content/themes/noriks/img/starter-3.png
">
      </div>
    </div>

    <!-- Right Content -->
    <div class="why-col why-content">
      <h2 style="color: #222; text-align:left; margin-left: 20px; font-family: 'Barlow', sans-serif; color:#222223;">
NAJƒΩAH≈†√ç A NAJBEZPEƒåNEJ≈†√ç ZAƒåIATOK
      </h2>

      <div style="margin-left: 20px;" class="why-point">
        <p><strong>Najmen≈°ie mo≈æn√© riziko


</strong></p>
        <p class="description">Preto≈æe v√°m umo≈æ≈àuje spozna≈• kvalitu bez veƒækej invest√≠cie.
Namiesto toho, aby ste si k√∫pili viac kusov vopred, vezmete si jedno triƒçko a jedny boxerky - akur√°t dos≈• na to, aby ste videli, ako sedia, ako sa nosia a ako sa materi√°l c√≠ti.

</p>
      </div>

      <div style="margin-left: 20px;" class="why-point">
        <p><strong>Navrhnut√© pre prv√Ω krok


</strong></p>
        <p class="description">≈†tartovac√≠ bal√≠k je navrhnut√Ω ako prv√° sk√∫senos≈•, nie ako z√°soba.
Je dostupn√Ω len raz na z√°kazn√≠ka a za ≈°peci√°lnu cenu, aby bolo rozhodnutie jednoduch√© a bez rozm√Ω≈°ƒæania.


</p>
      </div>

      <div style="margin-left: 20px;" class="why-point">
        <p><strong>Sk√∫senos≈•, ktor√° sa opakuje


</strong></p>
        <p class="description">V√§ƒç≈°ina mu≈æov potom pokraƒçuje s NORIKS, preto≈æe pochop√≠ rozdiel v strihu, pohodl√≠ a kvalite.
Ale prv√Ω krok je tento - najmen≈°ie riziko, najƒçistej≈°√≠ dojem.

</p>
      </div>
    </div>

  </div>
</section>



<?php endif; ?>







<?php
if (  has_term( array( 'tricky' ), 'product_cat', get_the_id() )  ||  has_term( 'black-friday', 'product_cat', get_the_id() )) :
?>





<section class="why-section">
  <div class="container why-container">

    <!-- Left Video -->
    <div class="why-col">
      <div class="video-wrapper">
        <video
          autoplay muted loop playsinline
          class="why-video">
          <source src="https://noriks.com/hr/wp-content/uploads/2025/09/noriks_gif_hr_2-1.mp4" type="video/mp4">
          Your browser does not support the video tag.
        </video>
      </div>
    </div>

    <!-- Right Content -->
    <div class="why-col why-content">
      <h2 style="color: #222; text-align:left; margin-left: 20px; font-family: 'Barlow', sans-serif; color:#222223;">
        <?php echo get_field( 'singlepp_content_part_h1', 'options' ); ?>
      </h2>

      <div style="margin-left: 20px;" class="why-point">
        <p><strong><?php echo get_field( 'singlepp_content_part_t_1', 'options' ); ?></strong></p>
        <p class="description"><?php echo get_field( 'singlepp_content_part_t_2', 'options' ); ?></p>
      </div>

      <div style="margin-left: 20px;" class="why-point">
        <p><strong><?php echo get_field( 'singlepp_content_part_t_3', 'options' ); ?></strong></p>
        <p class="description"><?php echo get_field( 'singlepp_content_part_t_4', 'options' ); ?></p>
      </div>

      <div style="margin-left: 20px;" class="why-point">
        <p><strong><?php echo get_field( 'singlepp_content_part_t_5', 'options' ); ?></strong></p>
        <p class="description"><?php echo get_field( 'singlepp_content_part_t_6', 'options' ); ?></p>
      </div>
    </div>

  </div>
</section>








<!-- table section -->



<section class="comparison-section" style="padding-top: 30px;" >
    <div class="comparison-intro">
     <!-- <h4 class="highlight"><?php echo get_field("_comp_table_t1", "options"); ?></h4>-->
      <h1 style="color:white;"><?php echo get_field("_comp_table_t2", "options"); ?></h1>
      <p style="    opacity: 0.6;" class="note"><?php echo get_field("_comp_table_t3", "options"); ?></p>
    </div>
  </section>


<section class="comparison-table-section">

 <div class="comparison-container">
   <table class="comparison-table">
      <thead>
        <tr>
          <th></th>
          <th class="brand-column">
                <?php echo get_field("_comp_table_inside_1", "options"); ?><br>
            <div class="price"><?php echo get_field("_comp_table_inside_3", "options"); ?></div>
          </th>
          <th class="other-brand"><?php echo get_field("_comp_table_inside_2", "options"); ?><br><span><?php echo get_field("_comp_table_inside_4", "options"); ?></span></th>
        </tr>
      </thead>
      <tbody>

          <?php
          $_comp_table_fieldlines = get_field("_comp_table_fieldlines","options");
          ?>

            <?php if ($_comp_table_fieldlines): ?>
             <?php foreach ($_comp_table_fieldlines as $item): ?>

                    <tr>
                      <td><?php echo $item['text']; ?></td>
                      <td class="bg-best"><span  style="background: #496d8f;" class="checkmark">‚úî</span></td>
                      <td class="bg-bad"><span class="crossmark">‚úñ</span></td>
                    </tr>

            <?php endforeach; ?>
        <?php endif; ?>


      </tbody>
    </table>

    <p style="    opacity: 0.6;" class="small-note">
      <?php echo get_field("_comp_table_bottom_text", "options"); ?>
    </p>
  </div>
</section>



<section class="why-section">
  <div class="container why-container">

    <!-- Left Video -->
    <div class="why-col">
      <div class="video-wrapper">
          <img style="width: 100%;       
    aspect-ratio: 1/1; 
    object-fit: cover;  " src="/sk/wp-content/themes/noriks/img/majice-3 (1).jpeg">
      </div>
    </div>

    <!-- Right Content -->
    <div class="why-col why-content">
      <h2 style="color: #222; text-align:left; margin-left: 20px; font-family: 'Barlow', sans-serif; color:#222223;">
        PREƒåO SA TOTO TRIƒåKO STANE VA≈†√çM ≈†TANDARDOM?
      </h2>

      <div style="margin-left: 20px;" class="why-point">
        <p><strong>Navrhnut√© pre skutoƒçn√Ω ≈æivot
</strong></p>
        <p class="description">Toto triƒçko je vytvoren√© na celodenn√© nosenie, od r√°na do veƒçera. Nevy≈æaduje prisp√¥sobovanie ani prem√Ω≈°ƒæanie ‚Äî jednoducho sed√≠ dobre v ka≈ædej situ√°cii.
</p>
      </div>

      <div style="margin-left: 20px;" class="why-point">
        <p><strong>Strih, ktor√Ω rozumie telu
</strong></p>
        <p class="description">Strih bol vyvinut√Ω tak, aby sledoval l√≠niu tela bez s≈•ahovania a zv√Ωraz≈àoval to, ƒço treba. V√Ωsledkom je upraven√Ω, sebavedom√Ω vzhƒæad bez pocitu nepohodlia.
</p>
      </div>

      <div style="margin-left: 20px;" class="why-point">
        <p><strong>Poc√≠≈•te rozdiel u≈æ pri prvom nosen√≠
</strong></p>
        <p class="description">Materi√°l je m√§kk√Ω, ƒæahk√Ω a priedu≈°n√Ω na poko≈æke. Po prvom nosen√≠ je jasn√©, preƒço sa toto triƒçko r√Ωchlo st√°va t√Ωm, ktor√© si vyberiete najƒçastej≈°ie.
</p>
      </div>
    </div>

  </div>
</section>


<!-- table section -->

<?php endif; ?>







<!-- here we include new file BOXERIRICE-->

<?php if ( has_term( array( 'boxerky', 'boxerky-zostav-balenie' ), 'product_cat', get_the_ID() )  && !has_term( 'black-friday', 'product_cat', get_the_ID() ) ): ?>



<style>
    .why-container  {
    max-width: 1440px !important;
}

</style>


<?php
if(  get_the_ID() == 39181 ):
?>


<!-- invlude video views here -->


<?php
endif;
?>










<!-- 1 boksarica -->


<section class="why-section">
  <div class="container why-container">

    <!-- Left Video -->
    <div class="why-col">
       <img src="/sk/wp-content/uploads/2025/12/recreate_without_photo_equipment_98300wkq98yf4jbkroa5.jpg">
    </div>

    <!-- Right Content -->
    <div class="why-col why-content">
      <h2 style="color: #222; text-align:left; margin-left: 20px; font-family: 'Barlow', sans-serif; color:#222223;">
        Flexibiln√Ω strih pre silnej≈°ie nohy
      </h2>

      <div style="margin-left: 20px;" class="why-point">
        <p><strong>Celodenn√© pohodlie
</strong></p>
        <p class="description">≈†peci√°lne navrhnut√© pre mu≈æov so silnej≈°√≠mi stehnami. Elastick√Ω a roz≈•a≈æn√Ω materi√°l poskytuje maxim√°lne pohodlie bez s≈•ahovania alebo nepr√≠jemn√©ho p√°sa. Spodn√° bielize≈à zost√°va na mieste a nezdv√≠ha sa, tak≈æe sa m√¥≈æete voƒæne pohybova≈• cel√Ω de≈à.</p>
      </div>



    </div>

  </div>
</section>
<style>
/* your styles */
</style>





<!-- 2 boksarica -->

<section  style="background: white;" class="why-section">
  <div class="container why-container">

    <!-- Left Video -->
    <div class="why-col">
       <img src="/sk/wp-content/uploads/2025/12/recreate_this_picture_to_look_more_real_same_text_on_it_zidddz68sbcgp6wmizbl.jpg">
    </div>

    <!-- Right Content -->
    <div class="why-col why-content">
      <h2 style="color: #222; text-align:left; margin-left: 20px; font-family: 'Barlow', sans-serif; color:#222223;">
       Menej opotrebovania a po≈°kodenia
      </h2>

      <div style="margin-left: 20px;" class="why-point">
        <p><strong>Super odoln√© üí™
</strong></p>
        <p class="description">Zabudnite na neust√°le kupovanie roztrhanej spodnej bielizne. NORIKS boxerky s√∫ vyroben√© z pevnej≈°ieho materi√°lu - vydr≈æia dlh≈°ie a u≈°etria v√°m cestu do obchodu.
</p>
      </div>

      <div style="margin-left: 20px;" class="why-point">


        <p class="description">

        ‚úÖ Menej trhania  <br/>
        ‚úÖ Menej potenia  <br/>
        ‚úÖ Pohodlie poƒças cel√©ho d≈àa <br/>

        </p>
      </div>


    </div>

  </div>
</section>
<style>
/* your styles */
</style>




<!-- 3 boksarica -->

<section class="why-section">
  <div class="container why-container">

    <!-- Left Video -->
    <div class="why-col">
       <img style="width: 100%;
    aspect-ratio: 1/1;
    object-fit: cover;  " src="/sk/wp-content/uploads/2025/12/create_same_style_studio_photo_with_younger_guy_30_years_normal_look_and_croatian_can_look_midldle__e99c86vy07c57mjd38f6.jpg">
    </div>

    <!-- Right Content -->
    <div class="why-col why-content">
      <h2 style="color: #222; text-align:left; margin-left: 20px; font-family: 'Barlow', sans-serif; color:#222223;">
       Dostatok priestoru pre v≈°etko
      </h2>

      <div style="margin-left: 20px;" class="why-point">
        <p><strong>Chlapci, dovoƒæte svojmu rozkroku voƒæne d√Ωcha≈•!
</strong></p>
        <p class="description">NORIKS spodn√° bielize≈à poskytuje oporu poƒças cel√©ho d≈àa bez straty tvaru. Nebesky m√§kk√Ω Modal materi√°l sa na≈•ahuje a dokonale sadne na spr√°vnych miestach. Priestor pre va≈°e "vybavenie" je priestrannej≈°√≠ a flexibilnej≈°√≠, tak≈æe sa nec√≠tite stiesnene.</p>
      </div>



    </div>

  </div>
</section>
<style>
/* your styles */
</style>








<?php endif; ?>

<!-- end BOXERICE -->






<style>
    .most-popular {

        padding-top: 20px;

    }
</style>










<!--  BOXERICE stylee -->







<?php
/************ get products by category homepage  ************/

$products = array();

// If current product is in category 'boxerky' ‚Üí load all products from that category
if ( has_term( array( 'boxerky', 'orto-boxerky', 'boxerky-zostav-balenie' ), 'product_cat', get_the_ID() ) ) {

    // Get all products from category 'boxerky'
    $wc_products = wc_get_products( array(
        'limit'    => 8,
        'orderby'  => 'menu_order',
        'order'    => 'ASC',
        'category' => array( 'boxerky' )
    ) );

    if ( ! empty( $wc_products ) ) {
        foreach ( $wc_products as $product ) {
            if ( $product instanceof WC_Product ) {
                $products[] = $product;
            }
        }
    }

} else {

    // Default behavior: use ACF repeater from post ID 76
    if ( have_rows( 'homepage_section_2_product_list', 76 ) ) {
        while ( have_rows( 'homepage_section_2_product_list', 76 ) ) {
            the_row();

            // Get the product field (post object)
            $product_post = get_sub_field( 'product' );

            if ( $product_post && $product_post instanceof WP_Post ) {
                $product = wc_get_product( $product_post->ID );
                if ( $product instanceof WC_Product ) {
                    $products[] = $product;
                }
            }
        }
    }
}

/************ get products by category homepage  ************/
?>

<style>
@media (min-width: 769px) {
  .products-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 5px;
    justify-content: center;
  }
}

.product-card {
  background: #fff;
  border-radius: 0px;
  overflow: hidden;
  text-align: left;
  display: flex;
  flex-direction: column;
  height: 100%;
}

.image-wrapper {
  background: transparent;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  overflow: hidden;
}

/* ======= Image swap (hover second image) ======= */
.product-image-swap {
  position: relative;
  width: 100%;
}

.product-image-swap img {
  width: 100%;
  height: auto;
  display: block;
  transition: opacity 0.25s ease;
}

.product-image-swap img.secondary {
  position: absolute;
  inset: 0;
  opacity: 0;
}

.product-card:hover .product-image-swap img.primary {
  opacity: 0;
}

.product-card:hover .product-image-swap img.secondary {
  opacity: 1;
}

/* Disable hover swap on touch/mobile (optional but recommended) */
@media (max-width: 768px) {
  .product-card:hover .product-image-swap img.primary {
    opacity: 1;
  }
  .product-card:hover .product-image-swap img.secondary {
    opacity: 0;
  }
}
/* ======= /Image swap ======= */

.badge {
  position: absolute;
  top: 10px;
  right: 10px;
  background-color: #971b1b;
  color: white;
  font-family: 'Roboto', sans-serif;
  font-weight: 700;
  font-size: 10px;
  padding: 2px 8px 1px 8px;
  border-radius: 2px;
  text-transform: uppercase;
  z-index: 9999999999;
}

.top-liked {
  position: absolute;
  top: 10px;
  left: 10px;
  background-color: #496d8f;
  color: white;
  font-family: 'Roboto', sans-serif;
  font-weight: 700;
  font-size: 10px;
  padding: 2px 8px 1px 8px;
  border-radius: 2px;
  text-transform: uppercase;
  z-index: 99999999999;
}

.product-info {
  padding: 15px 15px 20px 15px;
  text-align: center;
}

.stars {
  font-size: 14px;
  color: #ffc107;
  margin-bottom: 0px;
}

.reviews {
  color: #333;
  font-weight: 400;
  margin-left: 5px;
}

.product-name {
  font-family: 'Roboto', sans-serif;
  text-align: left;
  font-weight: normal !important;
  margin-bottom: 0px !important;
  font-size: 1rem;
  text-align: center;
}

.price { margin-top: 0px; }

.current-price {
  font-size: 16px;
  color: #971b1b;
  margin-right: 8px;
}

.old-price {
  font-size: 16px;
  color: black;
  text-decoration: line-through;
  margin-right: 5px;
}

.link-to-pp {
  position: absolute;
  right: 10px;
  bottom: 41px;
  z-index: 99;
  background: #f5a622;
  width: 40px;
  height: 40px;
  z-index: 999999999;
}

a:focus,
a:hover {
  outline: none !important;
  box-shadow: none !important;
  color: inherit !important;
}

.section-title {
  font-size: 1.7rem;
  font-weight: 800;
  line-height: 1.1;
  text-align: center;
}

.section-subtitle {
  text-align: center;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function () {
  // Initialize Slick Carousel (Mobile only)
  if (window.innerWidth <= 768) {
    jQuery('.slider-mobile').not('.slick-initialized').slick({
      slidesToShow: 1,
      centerMode: true,
      centerPadding: '60px',
      arrows: false,
      dots: true,
      infinite: false
    });
  }
});
</script>

<style>
.slider-mobile .slick-list {
  padding-left: 0 !important;
  margin-left: 0px;
}

.slider-mobile {
  overflow: visible;
}

.slick-slide {
  transition: all 0.3s ease;
  margin-right: 20px !important;
  margin-left: -1px;
}

.slick-list {
  overflow: visible;
}

/* Full-width horizontal dot container */
.slick-dots {
  display: flex !important;
  justify-content: space-between;
  align-items: center;
  width: 100%;
  margin: 10px 0 0;
  padding: 0;
  list-style: none;
}

/* Optional: give some padding or spacing on the sides */
.slick-dots li {
  flex: 1;
  text-align: center;
}

/* Square dots */
.slick-dots li button {
  width: 95%;
  height: 7px;
  border-radius: 1px;
  background: #ccc;
  border: none;
  padding: 0;
  cursor: pointer;
  font-size: 0;
  margin: 0 auto;
}

/* Active dot style */
.slick-dots li.slick-active button {
  background: #333;
}

.slider-mobile {
  width: 100%;
}
</style>

<section style="display:block; max-width:1440px; margin:0 auto; padding-bottom:30px;" class="most-popular">
  <div class="container" style="padding-left:10px; padding-right:10px;">
    <h2 class="section-title" style="margin-bottom:20px;">Pripraven√© kombin√°cie - jednoducho a r√Ωchlo</h2>

    <div class="products-grid slider-mobile">
      <?php foreach ($products as $index => $product): ?>
        <?php
          $product_id   = $product->get_id();
          $product_link = get_permalink($product_id);
          $product_name = $product->get_name();

          // Featured image
          $product_image = wp_get_attachment_image_url($product->get_image_id(), 'woocommerce_thumbnail');

          // Build images array: featured first, then gallery
          $all_images = array();
          if ($product_image) {
            $all_images[] = $product_image;
          }

          $gallery_image_ids = $product->get_gallery_image_ids();
          if (!empty($gallery_image_ids)) {
            foreach ($gallery_image_ids as $gallery_id) {
              $image_url = wp_get_attachment_image_url($gallery_id, 'woocommerce_thumbnail');
              if ($image_url) {
                $all_images[] = $image_url;
              }
            }
          }

          // Primary + Secondary (hover)
          $primary_image   = !empty($all_images[0]) ? $all_images[0] : '';
          $secondary_image = !empty($all_images[1]) ? $all_images[1] : ''; // second image only

          // Prices
          if ($product->is_type('variable')) {
            $regular_price = $product->get_variation_regular_price('min', true);
            $sale_price    = $product->get_variation_sale_price('min', true);
          } else {
            $regular_price = $product->get_regular_price();
            $sale_price    = $product->get_sale_price();
          }

          $is_on_sale = $product->is_on_sale();
        ?>

        <div class="product-card" style="position:relative;">
          <a href="<?php echo $product_link; ?>" style="position:absolute; top:0; left:0; width:100%; z-index:99; height:100%;">

            <div class="image-wrapper">
              <?php
                $shirt_count     = get_field('number_of_shirts_in_this_product', $product->get_id());
                $alt_output      = false;
                $alt_output_text = get_field("singlepp_priceper_alternative_1piece","options");

                if (empty($shirt_count) || $shirt_count == 0) {
                  $shirt_count = 1;
                }

                $tmp_price = 0;
                if ($product->is_type('variable')) {
                  $tmp_price = $product->get_variation_sale_price('min', true);
                } else {
                  $tmp_price = $product->get_sale_price();
                }

                $tmp_price = $tmp_price / $shirt_count;
                $tmp_price = floor(($tmp_price + 0.00001) * 100) / 100;

                if ($shirt_count == 1) {
                  $alt_output = true;
                  $alt_output_text = get_field("singlepp_priceper_alternative_1piece","options");
                }

                // extra check if is multipack
                if ( get_field('multipack_option_1', get_the_ID()) == true ) {
                  $alt_output = true;
                  $alt_output_text = get_field("singlepp_priceper_alternative_multipack","options");
                }

                $topseler_text = get_field("singlepp_bestseller_text", "options");

                if ($shirt_count != 1):
                  if ($alt_output == false):
                    $is_boxers = has_term( array( 'boxerky', 'orto-boxerky' , 'boxerky-zostav-balenie' ), 'product_cat', $current_product_id );

                    if ($is_boxers):
                      $topseler_text = get_field("singlepp_priceper_before","options") . " " . $tmp_price . " " . "‚Ç¨ za boxerky";
                    else:
                      $topseler_text = get_field("singlepp_priceper_before","options") . " " . $tmp_price . " " . get_field("singlepp_priceper_after","options");
                    endif;
                  else:
                    // keep $topseler_text as-is if alternative output is used
                  endif;
                endif;
              ?>

              <?php if ($shirt_count != 1): ?>
               <!-- <div class="top-liked"><?php echo $topseler_text; ?></div>-->
              <?php endif; ?>

              <?php
                $discount = 0;

                if ( $product->is_type( 'variable' ) ) {
                  $regular_price_calc = (float) $product->get_variation_regular_price( 'min', true );
                  $sale_price_calc    = (float) $product->get_variation_sale_price( 'min', true );
                } else {
                  $regular_price_calc = (float) $product->get_regular_price();
                  $sale_price_calc    = (float) $product->get_sale_price();
                }

                if ( $sale_price_calc && $regular_price_calc && $regular_price_calc > $sale_price_calc ) {
                  $discount = round( ( ( $regular_price_calc - $sale_price_calc ) / $regular_price_calc ) * 100 );
                  echo '<span class="badge">-' . esc_html( $discount ) . '' . get_field("singlepp_discount_text","options") . ' </span>';
                }
              ?>

              <a style="display:none;" href="<?php echo $product_link; ?>" class="link-to-pp">
                <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <rect width="40" height="40" rx="2" fill="#F5A623"></rect>
                  <g clip-path="url(#clip0_24310_7887)">
                    <path d="M24 16C24 14.9391 23.5786 13.9217 22.8284 13.1716C22.0783 12.4214 21.0609 12 20 12C18.9391 12 17.9217 12.4214 17.1716 13.1716C16.4214 13.9217 16 14.9391 16 16H12V26C12 26.5304 12.2107 27.0391 12.5858 27.4142C12.9609 27.7893 13.4696 28 14 28H26C26.5304 28 27.0391 27.7893 27.4142 27.4142C27.7893 27.0391 28 26.5304 28 26V16H24ZM20 13.3333C20.7072 13.3333 21.3855 13.6143 21.8856 14.1144C22.3857 14.6145 22.6667 15.2928 22.6667 16H17.3333C17.3333 15.2928 17.6143 14.6145 18.1144 14.1144C18.6145 13.6143 19.2928 13.3333 20 13.3333Z" fill="white"></path>
                  </g>
                  <defs>
                    <clipPath id="clip0_24310_7887">
                      <rect width="16" height="16" fill="white" transform="translate(12 12)"></rect>
                    </clipPath>
                  </defs>
                </svg>
              </a>

              <!-- ‚úÖ NO GLIDE: only primary image + (on hover) secondary image -->
              <div class="product-image-swap">
                <?php if ($primary_image): ?>
                  <img class="primary" src="<?php echo esc_url($primary_image); ?>" alt="<?php echo esc_attr($product_name); ?>">
                <?php endif; ?>

                <?php if ($secondary_image): ?>
                  <img class="secondary" src="<?php echo esc_url($secondary_image); ?>" alt="<?php echo esc_attr($product_name); ?>">
                <?php endif; ?>
              </div>
              <!-- /NO GLIDE -->

            </div>

            <div class="product-info">

              <h3 class="product-name"><?php echo esc_html($product_name); ?></h3>

              <div class="price">
                <?php if ($is_on_sale): ?>
                  <span class="old-price"><?php echo wc_price($regular_price); ?></span>
                  <span class="current-price"><?php echo wc_price($sale_price); ?></span>
                <?php else: ?>
                  <span class="current-price"><?php echo wc_price($regular_price); ?></span>
                <?php endif; ?>
              </div>
            </div>

          </a>
        </div>

      <?php endforeach; ?>
    </div>

  </div>
</section>





















  <style>

      .comparison-section-gray  {
         border-radius: 5px;
        }

      .comparison-intro-gray  {
           margin-bottom: 0;
        }

  </style>
  <div  style="background: #f9f9f9; padding-top: 30px;" >
<section style="background: #f9f9f9; max-width: 1440px;" class="comparison-section comparison-section-gray">
    <div style="background: #f9f9f9;padding: 0;padding-left: 10px;
    padding-right: 10px;" class="comparison-intro comparison-intro-gray ">
      <!--<h4 style="" class="highlight"><?php echo get_field("singlepp_content_standard_reviews_t1","options"); ?></h4>-->
      <h1 style="color:black;     margin-bottom: 4px;">

          <?php if ( !has_term( array( 'boxerky', 'boxerky-zostav-balenie' ), 'product_cat', get_the_ID() ) ): ?>

          <?php echo get_field("singlepp_content_standard_reviews_t2","options"); ?>

          <?php else: ?>

          Nie ste sami v hƒæadan√≠ dokonal√Ωch boxeriek.

          <?php endif; ?>


          </h1>
    <p class="note" style="color: black; margin-top: 0px; margin-bottom: 5px;"><?php echo get_field("singlepp_content_standard_reviews_t3","options"); ?></p>
    </div>
  </section>
  </div>


  <style>
      @media (max-width: 768px) {

          .basic-reviews-section  {
               padding-left: 0px;
               padding-right: 0px;
            }
            .review .content {
                font-size: 13px;
            }
            .review .info {
                font-size: 13px;
                line-height: 1.3;
            }
            .review {

                padding-bottom: 15px;
                margin-bottom: 16px;

            }
      }
  </style>


  <style>
.loader {
  border: 4px solid #f3f3f3;
  border-top: 4px solid #f5a623;
  border-radius: 50%;
  width: 30px;
  height: 30px;
  animation: spin 0.8s linear infinite;
  margin: 0 auto;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.extra-review-group {
  opacity: 0;
  transition: opacity 0.5s ease;
}

.extra-review-group.show {
  opacity: 1;
}
</style>







<?php
  // ===== CONFIG: LANGUAGE & DATA =====
  $reviews_language = get_field("webshop_language", "options");
  if (!$reviews_language) { $reviews_language = "EN"; }

  // Detect if current product belongs to boxerky group
  $current_product_id = (function_exists('is_product') && is_product()) ? get_queried_object_id() : get_the_id();
  $is_bokserice_page  = has_term( array( 'boxerky','orto-boxerky', 'boxerky-zostav-balenie' ), 'product_cat', $current_product_id );

  // Include review pools
  if ( ! $is_bokserice_page )  {
    include get_stylesheet_directory() . '/auto_reviews/'.$reviews_language.'.php';
  } else {
    include get_stylesheet_directory() . '/auto_reviews/HR_bokserice.php';
  }

  include get_stylesheet_directory() . '/auto_reviews/'.$reviews_language.'-2.php';

  // Ensure arrays exist
  $auto_reviews_en   = is_array($auto_reviews_en)   ? $auto_reviews_en   : [];
  $auto_reviews_ship = isset($auto_reviews_ship) && is_array($auto_reviews_ship) ? $auto_reviews_ship : [];

  // ===== HELPERS: STABLE DAILY RANDOMIZATION =====

  /**
   * Get WP/Woo timezone (fallback Europe/Ljubljana).
   */
  function reviews_wp_tz(): DateTimeZone {
    $tz_string = function_exists('wp_timezone_string') ? wp_timezone_string() : (get_option('timezone_string') ?: 'Europe/Ljubljana');
    return new DateTimeZone($tz_string ?: 'Europe/Ljubljana');
  }

  /**
   * Deterministic "random" integer in [0, $mod-1] from a seed string.
   */
  function stable_mod_index(string $seed, int $mod): int {
    if ($mod <= 0) return 0;
    $h = substr(sha1($seed), 0, 8); // 32-bit slice
    $n = hexdec($h);
    return (int) ($n % $mod);
  }

  /**
   * Deterministic shuffle based on a seed string. (Stable for a given seed.)
   */
  function shuffle_with_seed(array $arr, string $seed): array {
    if (empty($arr)) return $arr;
    $keys = array_keys($arr);
    usort($keys, function($a, $b) use ($seed) {
      $ha = sha1($seed . ':' . $a);
      $hb = sha1($seed . ':' . $b);
      return strcmp($ha, $hb);
    });
    $out = [];
    foreach ($keys as $k) { $out[] = $arr[$k]; }
    return $out;
  }

  /**
   * Build/caches a pool of products: [['title'=>..., 'url'=>...], ...]
   */
  function get_wc_product_pool(
      $transient_key = 'reviews_product_pool_cache_v2',
      $ttl = 12 * HOUR_IN_SECONDS
  ) {
      if ( ! function_exists( 'wc_get_products' ) ) {
          return [];
      }

      $product_id = 0;
      if ( function_exists( 'is_product' ) && is_product() ) {
          $product_id = get_queried_object_id();
      }

      $is_bokserice = false;
      if ( $product_id ) {
          $is_bokserice = has_term( array( 'boxerky','orto-boxerky', 'boxerky-zostav-balenie' ), 'product_cat', $product_id );
      }

      $cache_key = $transient_key . ( $is_bokserice ? '_boxerky' : '_all' );

      if ( function_exists( 'get_transient' ) ) {
          $cached = get_transient( $cache_key );
          if ( ! empty( $cached ) && is_array( $cached ) ) {
              return $cached;
          }
      }

      $args = [
          'status'  => 'publish',
          'limit'   => -1,
          'return'  => 'ids',
          'orderby' => 'date',
          'order'   => 'DESC',
      ];

      if ( $is_bokserice ) {
          $args['category'] = [ 'boxerky' ];
      } else {
          $args['tax_query'] = [
              [
                  'taxonomy' => 'product_cat',
                  'field'    => 'slug',
                  'terms'    => [ 'boxerky' ],
                  'operator' => 'NOT IN',
              ],
          ];
      }

      $ids = wc_get_products( $args );

      $pool = [];
      if ( ! empty( $ids ) ) {
          foreach ( $ids as $pid ) {
              $title = get_the_title( $pid );
              $url   = get_permalink( $pid );
              if ( $title && $url ) {
                  $pool[] = [
                      'title' => $title,
                      'url'   => $url,
                  ];
              }
          }
      }

      if ( function_exists( 'set_transient' ) ) {
          set_transient( $cache_key, $pool, $ttl );
      }

      return $pool;
  }

  /**
   * Load avatar images from theme folder and return URLs.
   * Expected folders:
   *  - /auto_reviews/boxerky-slike/
   *  - /auto_reviews/tricky-slike/
   */
  function get_review_avatar_pool(string $type = 'tricky'): array {
    $type = ($type === 'boxerky') ? 'boxerky' : 'tricky';

    $dir_path = trailingslashit(get_stylesheet_directory()) . 'auto_reviews/' . $type . '-slike/';
    $dir_url  = trailingslashit(get_stylesheet_directory_uri()) . 'auto_reviews/' . $type . '-slike/';

    if ( ! is_dir($dir_path) ) return [];

    $files = glob($dir_path . '*.{jpg,jpeg,png,webp,JPG,JPEG,PNG,WEBP}', GLOB_BRACE);
    if (empty($files)) return [];

    $urls = [];
    foreach ($files as $f) {
      $base = basename($f);
      if ($base && $base[0] !== '.') {
        $urls[] = $dir_url . rawurlencode($base);
      }
    }
    return $urls;
  }

  /**
   * Assign avatars (some real, some placeholder) deterministically per day + review index.
   * If real image is chosen, sets $r['avatar_url'].
   */
  function assign_avatars_stable(array $reviews, array $avatar_pool, string $daily_seed, string $context_seed = 'product', int $real_probability_percent = 60): array {
    $count = count($avatar_pool);
    foreach ($reviews as $i => &$r) {
      $r['avatar_url'] = '';

      if ($count <= 0) continue;

      $roll = stable_mod_index($daily_seed . ':avatar-roll:' . $context_seed . ':' . $i, 100);
      if ($roll < max(0, min(100, $real_probability_percent))) {
        $pick_i = stable_mod_index($daily_seed . ':avatar-pick:' . $context_seed . ':' . $i, $count);
        $r['avatar_url'] = $avatar_pool[$pick_i] ?? '';
      }
    }
    return $reviews;
  }



  /**
 * Avatar images rules:
 * - First $first_n reviews ALWAYS get an image (if available)
 * - Remaining images (unique) are placed randomly within reviews [$range_start .. $range_end]
 * - Each image can appear ONLY once
 * - Deterministic per day (stable daily seed)
 */
function assign_unique_avatars_first3_then_random_until30(
  array $reviews,
  array $avatar_pool,
  string $daily_seed,
  string $context_seed = 'product',
  int $first_n = 3,
  int $range_start = 3,   // 0-based index: review #4
  int $range_end = 30     // 1-based count: up to review #30 -> last index 29
): array {
  $total = count($reviews);
  if ($total <= 0) return $reviews;

  // Ensure key exists and default is placeholder
  foreach ($reviews as &$r) { $r['avatar_url'] = ''; }
  unset($r);

  if (empty($avatar_pool)) return $reviews;

  // Deterministic shuffle of images (stable per day)
  $pool = shuffle_with_seed($avatar_pool, 'avatar-pool:' . $daily_seed . ':' . $context_seed);
  $pool_count = count($pool);

  // 1) First N reviews always get images (as many as available)
  $first_n = max(0, min($first_n, $total, $pool_count));
  for ($i = 0; $i < $first_n; $i++) {
    $reviews[$i]['avatar_url'] = $pool[$i] ?? '';
  }

  // If no more images left, finish
  if ($pool_count <= $first_n) return $reviews;

  // 2) Randomly place remaining images from review #4 to #30 (indexes 3..29)
  $last_index = min($total - 1, $range_end - 1);
  if ($last_index < $range_start) return $reviews;

  $eligible = range($range_start, $last_index);

  // Deterministic shuffle of eligible positions (stable per day)
  $eligible = shuffle_with_seed($eligible, 'avatar-positions:' . $daily_seed . ':' . $context_seed);

  $remaining_images = array_slice($pool, $first_n);
  $take = min(count($remaining_images), count($eligible));

  for ($j = 0; $j < $take; $j++) {
    $pos = $eligible[$j];
    $reviews[$pos]['avatar_url'] = $remaining_images[$j] ?? '';
  }

  return $reviews;
}



  /**
 * Assign avatars for first N reviews:
 * - Use each real image at most once (no repeats).
 * - Only apply to first $use_first_n reviews.
 * - After that (or if pool runs out), use placeholder (avatar_url = '').
 * Deterministic per day.
 */
function assign_unique_avatars_first_n(array $reviews, array $avatar_pool, string $daily_seed, string $context_seed = 'product', int $use_first_n = 10): array {
  $total = count($reviews);
  if ($total <= 0) return $reviews;

  // Ensure every review has the key
  foreach ($reviews as &$r) { $r['avatar_url'] = ''; }
  unset($r);

  if (empty($avatar_pool)) return $reviews;

  // Deterministic shuffled image order for the day + context
  $shuffled_pool = shuffle_with_seed($avatar_pool, 'avatar-pool:' . $daily_seed . ':' . $context_seed);

  // We can only place as many images as we have, and only in first N reviews
  $limit = min($use_first_n, $total, count($shuffled_pool));

  for ($i = 0; $i < $limit; $i++) {
    $reviews[$i]['avatar_url'] = $shuffled_pool[$i] ?? '';
  }

  return $reviews;
}

  /**
   * Assign a deterministic product (title+url) to each review for the day.
   * Stable per day AND per review index.
   */
  function assign_products_stable(array $reviews, array $product_pool, string $daily_seed): array {
    $count = count($product_pool);
    foreach ($reviews as $i => &$r) {
      if ($count > 0) {
        $pick = $product_pool[ stable_mod_index($daily_seed . ':prod:' . $i, $count) ];
        $r['product_title'] = $pick['title'];
        $r['product_url']   = $pick['url'];
      } else {
        $r['product_title'] = $r['product_title'] ?? '';
        $r['product_url']   = $r['product_url']   ?? '';
      }
    }
    return $reviews;
  }

  /**
   * Distribute review dates backward from today to a cutoff date (inclusive),
   * with a deterministic per-day count using the daily seed.
   */
  function assign_dates_stable(array $reviews, string $cutoff_date_string = '20.6.2025', int $min_per_day = 2, int $max_per_day = 9, string $display_format = 'j.n.Y'): array {
    if (empty($reviews)) return $reviews;

    $tz      = reviews_wp_tz();
    $today   = new DateTime('today', $tz);
    $cutoff  = DateTime::createFromFormat('j.n.Y', $cutoff_date_string, $tz) ?: new DateTime('20.6.2025', $tz);
    if ($cutoff > $today) $cutoff = clone $today;

    $daily_seed = $today->format('Y-m-d');
    $reviews    = shuffle_with_seed($reviews, 'reviews-order:' . $daily_seed);

    $total    = count($reviews);
    $assigned = 0;
    $day_off  = 0;

    while ($assigned < $total) {
      $date = (clone $today)->modify("-{$day_off} days");
      if ($date < $cutoff) $date = clone $cutoff;

      $span   = max(0, $max_per_day - $min_per_day);
      $add    = ($span > 0) ? (stable_mod_index('perday:'.$daily_seed.':'.$day_off, $span + 1)) : 0;
      $perday = $min_per_day + $add;

      $take = min($perday, $total - $assigned);
      for ($i = 0; $i < $take; $i++) {
        $reviews[$assigned]['assigned_date'] = $date->format($display_format);
        $assigned++;
      }

      $day_off++;
      if ($date == $cutoff && $assigned >= $total) break;
    }

    foreach ($reviews as &$r) {
      if (empty($r['assigned_date'])) $r['assigned_date'] = $cutoff->format($display_format);
    }
    return $reviews;
  }

  // ===== BUILD FOR TODAY =====
  $tz         = reviews_wp_tz();
  $today_obj  = new DateTime('today', $tz);
  $daily_seed = $today_obj->format('Y-m-d');

  // Avatar pools based on page category
  $avatar_type = $is_bokserice_page ? 'boxerky' : 'tricky';
  $avatar_pool = get_review_avatar_pool($avatar_type);

  $product_pool = get_wc_product_pool();

  // 1) Stable daily shuffle of review pools
  $auto_reviews_en   = shuffle_with_seed($auto_reviews_en,   'pool-en:'   . $daily_seed);
  $auto_reviews_ship = shuffle_with_seed($auto_reviews_ship, 'pool-ship:' . $daily_seed);

  // 2) Stable product assignment for the day
  $auto_reviews_en   = assign_products_stable($auto_reviews_en,   $product_pool, $daily_seed);
  $auto_reviews_ship = assign_products_stable($auto_reviews_ship, $product_pool, $daily_seed);

  // 3) Deterministic date distribution back to cutoff 20.06.2025
  $auto_reviews_en   = assign_dates_stable($auto_reviews_en,   '20.6.2025', 2, 9, 'j.n.Y');
  $auto_reviews_ship = assign_dates_stable($auto_reviews_ship, '20.6.2025', 2, 9, 'j.n.Y');


  // 4) Deterministic avatars (some real, some placeholder)
$auto_reviews_en   = assign_unique_avatars_first3_then_random_until30($auto_reviews_en,   $avatar_pool, $daily_seed, 'product', 3, 3, 30);

$auto_reviews_ship = assign_unique_avatars_first_n($auto_reviews_ship, $avatar_pool, $daily_seed, 'shipping', 0);




  // ===== PAGINATION CHUNKS =====
  $initial_count = 18;   // show on load
  $load_count    = 9;    // per "load more"

  $initial_product   = array_slice($auto_reviews_en, 0, $initial_count);
  $remaining_product = array_slice($auto_reviews_en, $initial_count);
  $chunks_product    = array_chunk($remaining_product, $load_count);

  $initial_ship   = array_slice($auto_reviews_ship, 0, $initial_count);
  $remaining_ship = array_slice($auto_reviews_ship, $initial_count);
  $chunks_ship    = array_chunk($remaining_ship, $load_count);

  // Dynamic counts
  $prod_count = count($auto_reviews_en);
  $ship_count = count($auto_reviews_ship);
?>

<section id="reviews-section" class="basic-reviews-section" style="margin-bottom:40px!important;padding-bottom:40px!important;">
  <div class="container basic-reviews-section-container" style="width:100%;max-width:1440px;padding-top:20px!important;margin:0 auto;padding-left: 10px; padding-right: 10px;">

    <!-- Tabs -->
    <div class="reviews-tabs" style="display:flex;gap:18px;border-bottom:1px solid #cbc8c8;margin-bottom:18px;">
      <button type="button" class="reviews-tab is-active" data-tab="product"
        style="appearance:none;background:#00000008;border:1px solid #cbc8c8;border-bottom:0;padding:8px 14px;border-radius:0;font-weight:700;">
        <?php echo esc_html__('Recenzie produktov', 'your-textdomain'); ?> (692)
      </button>
      <button type="button" class="reviews-tab" data-tab="shipping"
        style="appearance:none;background:transparent;border:1px solid transparent;border-bottom:0;padding:8px 14px;border-radius:0;font-weight:700;">
        <?php echo esc_html__('Recenzie doruƒçenia', 'your-textdomain'); ?> (389)
      </button>
    </div>

    <!-- PRODUCT GRID (default visible) -->
    <div class="reviews-grid" id="reviews-grid-product">
      <?php if (!empty($initial_product)) : foreach ($initial_product as $review) :
        $name  = $review['name'] ?? 'Anonymn√Ω';
        $text  = $review['text'] ?? '';
        $title = !empty($review['product_title']) ? $review['product_title'] : 'Jedno siv√© triƒçko';
        $url   = !empty($review['product_url'])   ? $review['product_url']   : '#';
        $stars = '‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ';
        $date_display = $review['assigned_date'] ?? '';
        $avatar_url   = !empty($review['avatar_url']) ? $review['avatar_url'] : '';
      ?>
        <article class="review-card">
          <div class="card-top">
            <h3 class="product-title"><a href="<?php echo esc_url($url); ?>">
              <?php echo esc_html($title); ?>
            </a></h3>
            <div class="date">
              <?php echo esc_html($date_display); ?>
            </div>
          </div>
          <div class="stars"><?php echo $stars; ?></div>
          <div class="identity">
            <?php if ($avatar_url) : ?>
              <div class="avatar"><img src="<?php echo esc_url($avatar_url); ?>" alt="" loading="lazy" /></div>
            <?php else : ?>
              <div class="avatar">üë§</div>
            <?php endif; ?>
            <div class="name"><?php echo esc_html($name); ?></div>
            <span class="verified"><?php _e('Overen√©','your-textdomain'); ?></span>
          </div>
          <div class="content"><?php echo esc_html($text); ?></div>
        </article>
      <?php endforeach; endif; ?>
    </div>

    <!-- SHIPPING GRID (hidden initially) -->
    <div class="reviews-grid" id="reviews-grid-shipping" style="display:none;">
      <?php if (!empty($initial_ship)) : foreach ($initial_ship as $review) :
        $name  = $review['name'] ?? 'Anonymn√Ω';
        $text  = $review['text'] ?? '';
        $title = !empty($review['product_title']) ? $review['product_title'] : 'Jedno siv√© triƒçko';
        $url   = !empty($review['product_url'])   ? $review['product_url']   : '#';
        $stars = '‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ';
        $date_display = $review['assigned_date'] ?? '';
        $avatar_url   = !empty($review['avatar_url']) ? $review['avatar_url'] : '';
      ?>
        <article class="review-card">
          <div class="card-top">
            <h3 class="product-title">
              <a href="<?php echo esc_url($url); ?>">
                <?php echo esc_html($title); ?>
              </a>
            </h3>
            <div class="date">
              <?php echo esc_html($date_display); ?>
            </div>
          </div>
          <div class="stars"><?php echo $stars; ?></div>
          <div class="identity">
            <?php if ($avatar_url) : ?>
              <div class="avatar"><img src="<?php echo esc_url($avatar_url); ?>" alt="" loading="lazy" /></div>
            <?php else : ?>
              <div class="avatar">üë§</div>
            <?php endif; ?>
            <div class="name"><?php echo esc_html($name); ?></div>
            <span class="verified"><?php _e('Overen√©','your-textdomain'); ?></span>
          </div>
          <?php if (!empty($review['headline'])) : ?>
            <div class="headline"><?php echo esc_html($review['headline']); ?></div>
          <?php endif; ?>
          <div class="content"><?php echo esc_html($text); ?></div>
        </article>
      <?php endforeach; endif; ?>
    </div>

  </div>

  <!-- Controls: one CTA row, reused per tab -->
  <div class="container basic-reviews-section-container" style="width:100%;max-width:1100px;margin-top:30px!important;margin:0 auto;">
    <div class="cta-button" style="background:transparent;padding:0;justify-content:left;">
      <a class="cta-button2 button button--xl"
         style="margin:0 auto;text-align:left;background:black;font-family:'Roboto',sans-serif;color:#fff;text-transform:none;font-size:15px;padding:10px 25px;"
         href="#"><?php echo get_field("singlepp_content_standard_reviews_seemore_button","options"); ?></a>
    </div>
    <div id="reviews-loading" style="display:none;text-align:center;padding:15px;">
      <div class="loader"></div>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function(){
    // Data from PHP (already include product_title/product_url/assigned_date/avatar_url)
    const chunksProduct = <?php echo json_encode($chunks_product); ?>;
    const chunksShip    = <?php echo json_encode($chunks_ship); ?>;

    let nextProduct = 0;
    let nextShip    = 0;

    const tabs    = document.querySelectorAll('.reviews-tab');
    const gridP   = document.getElementById('reviews-grid-product');
    const gridS   = document.getElementById('reviews-grid-shipping');
    const seeMore = document.querySelector('.cta-button2');
    const loader  = document.getElementById('reviews-loading');

    let activeTab = 'product';

    function setTab(tab){
      activeTab = tab;
      tabs.forEach(t=>{
        if(t.dataset.tab === tab){ t.classList.add('is-active'); t.style.background='#00000008'; t.style.borderColor='#e6e6e6'; }
        else{ t.classList.remove('is-active'); t.style.background='transparent'; t.style.borderColor='transparent'; }
      });
      if(tab === 'product'){ gridP.style.display='grid'; gridS.style.display='none'; }
      else{ gridP.style.display='none'; gridS.style.display='grid'; }

      const moreAvail = tab === 'product'
        ? (nextProduct < (chunksProduct?.length || 0))
        : (nextShip < (chunksShip?.length || 0));
      if (seeMore) seeMore.style.display = moreAvail ? 'inline-block' : 'none';
    }

    setTab('product');
    tabs.forEach(btn => btn.addEventListener('click', ()=> setTab(btn.dataset.tab)));

    // Escape helper
    const esc = (str) => String(str ?? '').replace(/[&<>"']/g, s => ({
      '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'
    }[s]));

    function avatarHtml(avatarUrl){
      if(avatarUrl){
        return `<div class="avatar"><img src="${esc(avatarUrl)}" alt="" loading="lazy" /></div>`;
      }
      return `<div class="avatar">üë§</div>`;
    }

    // Append a chunk of cards into a grid
    function appendChunk(grid, chunk){
      chunk.forEach(function(review){
        const article = document.createElement('article');
        article.className = 'review-card is-new';

        const url       = review.product_url   || '#';
        const title     = review.product_title || 'Jedno siv√© triƒçko';
        const name      = review.name          || 'Anonymn√Ω';
        const text      = review.text          || '';
        const headline  = review.headline      || '';
        const date      = review.assigned_date || '';
        const avatarUrl = review.avatar_url    || '';

        article.innerHTML = `
          <div class="card-top">
            <h3 class="product-title"><a href="${esc(url)}">${esc(title)}</a></h3>
            <div class="date">${esc(date)}</div>
          </div>
          <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
          <div class="identity">
            ${avatarHtml(avatarUrl)}
            <div class="name">${esc(name)}</div>
            <span class="verified"><?php _e('Overen√©','your-textdomain'); ?></span>
          </div>
          ${headline ? `<div class="headline">${esc(headline)}</div>` : ''}
          <div class="content">${esc(text)}</div>
        `;
        grid.appendChild(article);
      });
    }

    seeMore && seeMore.addEventListener('click', function(e){
      e.preventDefault();
      seeMore.style.display='none';
      loader.style.display='block';

      setTimeout(function(){
        if(activeTab === 'product' && nextProduct < (chunksProduct?.length || 0)){
          appendChunk(gridP, chunksProduct[nextProduct]);
          nextProduct++;
        }else if(activeTab === 'shipping' && nextShip < (chunksShip?.length || 0)){
          appendChunk(gridS, chunksShip[nextShip]);
          nextShip++;
        }
        loader.style.display='none';
        const moreAvail = activeTab === 'product'
          ? (nextProduct < (chunksProduct?.length || 0))
          : (nextShip < (chunksShip?.length || 0));
        if(moreAvail) seeMore.style.display='inline-block';
      }, 400);
    });
  });
</script>

<!-- new review styling -->
<style>
/* ===== Reviews: Full corrected CSS ===== */

/* Section + container */
#reviews-section{
  font-family: "Roboto", system-ui, -apple-system, Segoe UI, Arial, sans-serif;
  background:#f9f9f9;
}
.basic-reviews-section-container{
  max-width:1440px;
  margin:0 auto;
  padding:0 0px;
}

/* Tabs */
.reviews-tabs{ display:flex; gap:18px; border-bottom:1px solid #eee; margin-bottom:18px; }
.reviews-tab{
  appearance:none; background:transparent; border:1px solid transparent; border-bottom:0;
  padding:8px 14px; font-weight:700; cursor:pointer;
}
.reviews-tab.is-active{ background:#00000008; border-color:#e6e6e6; }

/* Grid */
.reviews-grid{
  display:grid;
  grid-template-columns:repeat(3, 1fr);
  gap:10px;
  width:100%;
}
@media (max-width:1100px){
  .reviews-grid{ grid-template-columns:repeat(2, 1fr); }
}
@media (max-width:640px){
  .reviews-grid{ grid-template-columns:1fr; }
}

/* Card */
.review-card{
  width:100%;
  height:100%;
  background:#fff;
  border:1px solid #efefef;
  border-radius:4px;
  box-shadow: 0px 4px 16px rgba(0, 0, 0, 0.1);
  padding:18px 20px;
  display:flex;
  flex-direction:column;
}

/* Card top */
.review-card .card-top{
  display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
  margin:-2px 0 6px;
}
.review-card .product-title{
  margin:0; font-weight:800; font-size:16px; line-height:1.25;
}
.review-card .product-title a{
  color:#0e0e0e; text-decoration:underline; text-underline-offset:2px;
}
.review-card .date{
  color:#8c8c8c; font-size:13px; white-space:nowrap; margin-top:2px;
}

/* Stars */
.review-card .stars{
  letter-spacing:3px; font-size:18px; color:#0f0f0f; margin:2px 0 10px;
}

/* Identity */
.review-card .identity{

  display:flex;
  align-items:flex-start;   /* ‚¨ÖÔ∏è top-align items */
  gap:12px;
  margin:2px 0 12px;


}
.review-card .avatar{
  width:32px; height:32px;
  border:1px solid #dfdfdf;
  border-radius:0px;
  display:flex; align-items:center; justify-content:center;
  font-size:18px; color:#000; background:#fff;
  overflow:hidden;
}
.review-card .avatar img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
}
.review-card .name{ font-weight:700; color:#111; font-size:15px; }
.review-card .verified{
  display:inline-block; background:#0f0f0f; color:#fff;
  font-size:12px; font-weight:700; line-height:1;
  padding:5px 8px 4px; border-radius:3px; margin-left:6px;
}

/* Headline + body */
.review-card .headline{ font-weight:800; font-size:16px; color:#111; margin:6px 0 6px; }
.review-card .content{ color:#2b2b2b; font-size:15px; line-height:1.7; }

/* Reveal for appended cards */
.review-card.is-new{ animation:rv-fade .28s ease-out both; }
@keyframes rv-fade{ from{opacity:0; transform:translateY(6px);} to{opacity:1; transform:none;} }

/* Loader */
#reviews-loading .loader{
  width:28px; height:28px; border:3px solid #e6e6e6; border-top-color:#111; border-radius:50%;
  margin:0 auto; animation:rv-spin .75s linear infinite;
}
@keyframes rv-spin{ to{ transform:rotate(360deg);} }



/* Default avatar (placeholder) stays 32x32 */
.review-card .avatar{
  width:32px;
  height:32px;
  border:1px solid #dfdfdf;
  border-radius:0px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:18px;
  color:#000;
  background:#fff;
  overflow:hidden;
}

/* If avatar contains a real image -> make it 80x80 */
.review-card .avatar:has(img){
  width:250px;
  height:250px;
  font-size:0; /* hide any accidental text spacing */
  align-items:stretch;
  justify-content:stretch;
}

.review-card .avatar img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
}

/* ONLY reviews with real image */
.review-card .identity:has(.avatar img){
  display:block;              /* ‚¨ÖÔ∏è image gets own row */
}

/* Real image wrapper */
.review-card .avatar:has(img){
  width:100%;
  height:auto;
  border:none;
  margin-bottom:10px;
}

/* Real image itself */
.review-card .avatar img{
  width:100%;
  max-width:320px;
  height:auto;
  display:block;
  object-fit:cover;
  border:1px solid #dfdfdf;
  border-radius:4px;
}

/* Name + verified BELOW image */
.review-card .identity:has(.avatar img) .name,
.review-card .identity:has(.avatar img) .verified{
  display:inline-block;
  vertical-align:middle;
}


@media (max-width: 991px){

  /* ONLY reviews with real image */
  .review-card .avatar:has(img){
    max-width:100%;
  }

  .review-card .avatar img{
    width:100%;        /* ‚úÖ full width on mobile */
    max-width:100%;
    height:auto;
  }

}


</style>






<?php
$faq_list = get_field('faq_list', 'option');
$faq_list2 = get_field('faq_list_2', 'option');
$faq_list3 = get_field('faq_list_3', 'option');
?>





<section class="faq-section">
  <h2><?php echo get_field("singlepp_content_part_faq_h1","options"); ?></h2>


   <!-- first faq container -->
      <div class="faq-container">
         <h4 style="text-align:left; font-size: 1rem;
            font-weight: 700;
            color: #222223;
            margin-bottom: 10px; "><?php echo get_field('faq_title_1', 'option'); ?></h4>
            <?php
              if( $faq_list && is_array($faq_list) ):
                      foreach( $faq_list as $faq_item ):
              ?>
                    <div class="faq-item">
                      <button class="faq-question">
                         <?php echo $faq_item["questioon"]; ?>
                        <span class="arrow">&#9660;</span>
                      </button>
                      <div class="faq-answer">
                        <p>  <?php echo $faq_item["answer"]; ?></p>
                      </div>
                    </div>
          <?php endforeach;
            endif;
            ?>
      </div>
    <!-- first faq container -->

     <!-- 2 faq container -->
      <div class="faq-container">
          <br/>
         <h4 style="text-align:left; font-size: 1rem;
            font-weight: 700;
            color: #001e36;
            margin-bottom: 10px; "><?php echo get_field('faq_title_2', 'option'); ?></h4>
            <?php
              if( $faq_list2 && is_array($faq_list2) ):
                      foreach( $faq_list2 as $faq_item ):
              ?>
                    <div class="faq-item">
                      <button class="faq-question">
                         <?php echo $faq_item["questioon"]; ?>
                        <span class="arrow">&#9660;</span>
                      </button>
                      <div class="faq-answer">
                        <p>  <?php echo $faq_item["answer"]; ?></p>
                      </div>
                    </div>
          <?php endforeach;
            endif;
            ?>
      </div>
        <!-- 2 faq container -->

     <!-- 3 faq container -->
      <div class="faq-container">
          <br/>
         <h4 style="text-align:left; font-size: 1rem;
            font-weight: 700;
            color: #001e36;
            margin-bottom: 10px; "><?php echo get_field('faq_title_3', 'option'); ?></h4>
            <?php
              if( $faq_list3 && is_array($faq_list3) ):
                      foreach( $faq_list3 as $faq_item ):
              ?>
                    <div class="faq-item">
                      <button class="faq-question">
                         <?php echo $faq_item["questioon"]; ?>
                        <span class="arrow">&#9660;</span>
                      </button>
                      <div class="faq-answer">
                        <p>  <?php echo $faq_item["answer"]; ?></p>
                      </div>
                    </div>
          <?php endforeach;
            endif;
            ?>
      </div>
  <!-- 3 faq container -->

</section>

<script>
  document.querySelectorAll('.faq-question').forEach(button => {
    button.addEventListener('click', () => {
      const faqAnswer = button.nextElementSibling;
      const arrow = button.querySelector('.arrow');

      if (faqAnswer.style.maxHeight) {
        faqAnswer.style.maxHeight = null;
        arrow.style.transform = 'rotate(0deg)';
      } else {
        document.querySelectorAll('.faq-answer').forEach(item => {
          item.style.maxHeight = null;
        });
        document.querySelectorAll('.arrow').forEach(item => {
          item.style.transform = 'rotate(0deg)';
        });
        faqAnswer.style.maxHeight = faqAnswer.scrollHeight + 'px';
        arrow.style.transform = 'rotate(180deg)';
      }
    });
  });
</script>



